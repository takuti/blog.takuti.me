---
layout: post
title: "マルコフ連鎖によるツイートの文字数を考える"
categories:
- tech
tags:
- Natural Language Processing
status: publish
type: post
published: true
meta:
  _edit_last: '1'
  _aioseop_keywords: "マルコフ連鎖,Bot,Twitter,自然言語処理"
  _aioseop_description: "自分のツイートとマルコフ連鎖によるbotのツイートの文字数をヒストグラムで比較した上で、マルコフ連鎖によるツイートの文字数に上限を設定しました。"
  _aioseop_title: "マルコフ連鎖によるツイートの文字数を考える"
  _thumbnail_id: '397'
  dsq_thread_id: '2070859786'
  _oembed_ed9e27952d2c96c0f26e192dce495ff1: <blockquote class="twitter-tweet" width="546"><p>そろそろバスですバス代失うような気もきたし、病み上がりはどこかうちの？ねぇ君どこもおかしくない、質問攻めにあったようなじかんじゃねーの印象は消えてます！というわけで寝よー。てか9時か悩んでるなう・・・・ぼくだかも体調管理実装あ、情報処理技術者試験までは考えた</p>&mdash;
    ヨーグルト (@yootakuti) <a href="https://twitter.com/yootakuti/statuses/413693204735606784">December
    19, 2013</a></blockquote><script async src="//platform.twitter.com/widgets.js"
    charset="utf-8"></script>
  _oembed_e1f07e179d5852021414783ef9fe62b5: <blockquote class="twitter-tweet" width="546"><p>お！！！また大失敗して自殺行為じゃ、じゃあ脱がなくてしょぼんなど…だとコーン</p>&mdash;
    ヨーグルト (@yootakuti) <a href="https://twitter.com/yootakuti/statuses/415369180116811777">December
    24, 2013</a></blockquote><script async src="//platform.twitter.com/widgets.js"
    charset="utf-8"></script>
  _oembed_acc1bb61e4c13a195e29c0b72d5eebb8: <blockquote class="twitter-tweet" width="500"><p>そろそろバスですバス代失うような気もきたし、病み上がりはどこかうちの？ねぇ君どこもおかしくない、質問攻めにあったようなじかんじゃねーの印象は消えてます！というわけで寝よー。てか9時か悩んでるなう・・・・ぼくだかも体調管理実装あ、情報処理技術者試験までは考えた</p>&mdash;
    ヨーグルト (@yootakuti) <a href="https://twitter.com/yootakuti/statuses/413693204735606784">December
    19, 2013</a></blockquote><script async src="//platform.twitter.com/widgets.js"
    charset="utf-8"></script>
  _oembed_28829d213deb930f0f3a7d722603a4dd: <blockquote class="twitter-tweet" width="500"><p>お！！！また大失敗して自殺行為じゃ、じゃあ脱がなくてしょぼんなど…だとコーン</p>&mdash;
    ヨーグルト (@yootakuti) <a href="https://twitter.com/yootakuti/statuses/415369180116811777">December
    24, 2013</a></blockquote><script async src="//platform.twitter.com/widgets.js"
    charset="utf-8"></script>
  _oembed_da6792e460a9ec8ad7d63dce89df538c: <blockquote class="twitter-tweet" width="474"><p>そろそろバスですバス代失うような気もきたし、病み上がりはどこかうちの？ねぇ君どこもおかしくない、質問攻めにあったようなじかんじゃねーの印象は消えてます！というわけで寝よー。てか9時か悩んでるなう・・・・ぼくだかも体調管理実装あ、情報処理技術者試験までは考えた</p>&mdash;
    ヨーグルト (@yootakuti) <a href="https://twitter.com/yootakuti/statuses/413693204735606784">December
    19, 2013</a></blockquote><script async src="//platform.twitter.com/widgets.js"
    charset="utf-8"></script>
  _oembed_7ec3592733180c77a4d4174b3f3c249d: <blockquote class="twitter-tweet" width="550"><p>そろそろバスですバス代失うような気もきたし、病み上がりはどこかうちの？ねぇ君どこもおかしくない、質問攻めにあったようなじかんじゃねーの印象は消えてます！というわけで寝よー。てか9時か悩んでるなう・・・・ぼくだかも体調管理実装あ、情報処理技術者試験までは考えた</p>&mdash;
    ヨーグルト (@yootakuti) <a href="https://twitter.com/yootakuti/statuses/413693204735606784">December
    19, 2013</a></blockquote><script async src="//platform.twitter.com/widgets.js"
    charset="utf-8"></script>
  _oembed_fae53bb8aeca64794274da49f05c889b: <blockquote class="twitter-tweet" width="470"><p>そろそろバスですバス代失うような気もきたし、病み上がりはどこかうちの？ねぇ君どこもおかしくない、質問攻めにあったようなじかんじゃねーの印象は消えてます！というわけで寝よー。てか9時か悩んでるなう・・・・ぼくだかも体調管理実装あ、情報処理技術者試験までは考えた</p>&mdash;
    ヨーグルト (@yootakuti) <a href="https://twitter.com/yootakuti/statuses/413693204735606784">December
    19, 2013</a></blockquote><script async src="//platform.twitter.com/widgets.js"
    charset="utf-8"></script>
  _oembed_c5acc27e85829f9daf49e5b10a5aa5b8: <blockquote class="twitter-tweet" width="510"><p>そろそろバスですバス代失うような気もきたし、病み上がりはどこかうちの？ねぇ君どこもおかしくない、質問攻めにあったようなじかんじゃねーの印象は消えてます！というわけで寝よー。てか9時か悩んでるなう・・・・ぼくだかも体調管理実装あ、情報処理技術者試験までは考えた</p>&mdash;
    ヨーグルト (@yootakuti) <a href="https://twitter.com/yootakuti/statuses/413693204735606784">December
    19, 2013</a></blockquote><script async src="//platform.twitter.com/widgets.js"
    charset="utf-8"></script>
  _oembed_01adfc73a0afefd12f10eb5b17e17fc6: <blockquote class="twitter-tweet" width="550"><p>そろそろバスですバス代失うような気もきたし、病み上がりはどこかうちの？ねぇ君どこもおかしくない、質問攻めにあったようなじかんじゃねーの印象は消えてます！というわけで寝よー。てか9時か悩んでるなう・・・・ぼくだかも体調管理実装あ、情報処理技術者試験までは考えた</p>&mdash;
    ヨーグルト (@yootakuti) <a href="https://twitter.com/yootakuti/statuses/413693204735606784">December
    19, 2013</a></blockquote><script async src="//platform.twitter.com/widgets.js"
    charset="utf-8"></script>
  _oembed_95a6af9d16029195056bfd13efdff9cb: <blockquote class="twitter-tweet" width="550"><p>そろそろバスですバス代失うような気もきたし、病み上がりはどこかうちの？ねぇ君どこもおかしくない、質問攻めにあったようなじかんじゃねーの印象は消えてます！というわけで寝よー。てか9時か悩んでるなう・・・・ぼくだかも体調管理実装あ、情報処理技術者試験までは考えた</p>&mdash;
    ヨーグルト (@yootakuti) <a href="https://twitter.com/yootakuti/statuses/413693204735606784">December
    19, 2013</a></blockquote><script async src="//platform.twitter.com/widgets.js"
    charset="utf-8"></script>
  _oembed_bd3d4df9832ef497ea8c1248fe3bc36f: <blockquote class="twitter-tweet" width="550"><p>そろそろバスですバス代失うような気もきたし、病み上がりはどこかうちの？ねぇ君どこもおかしくない、質問攻めにあったようなじかんじゃねーの印象は消えてます！というわけで寝よー。てか9時か悩んでるなう・・・・ぼくだかも体調管理実装あ、情報処理技術者試験までは考えた</p>&mdash;
    ヨーグルト (@yootakuti) <a href="https://twitter.com/yootakuti/statuses/413693204735606784">December
    19, 2013</a></blockquote><script async src="//platform.twitter.com/widgets.js"
    charset="utf-8"></script>
  _oembed_0a27dc5ded3c2192724fdf3148070466: <blockquote class="twitter-tweet" width="550"><p>そろそろバスですバス代失うような気もきたし、病み上がりはどこかうちの？ねぇ君どこもおかしくない、質問攻めにあったようなじかんじゃねーの印象は消えてます！というわけで寝よー。てか9時か悩んでるなう・・・・ぼくだかも体調管理実装あ、情報処理技術者試験までは考えた</p>&mdash;
    ヨーグルト (@yootakuti) <a href="https://twitter.com/yootakuti/statuses/413693204735606784">December
    19, 2013</a></blockquote><script async src="//platform.twitter.com/widgets.js"
    charset="utf-8"></script>
  _oembed_e2fe990f133bef9dd572ad5d6f504b71: <blockquote class="twitter-tweet" width="550"><p>そろそろバスですバス代失うような気もきたし、病み上がりはどこかうちの？ねぇ君どこもおかしくない、質問攻めにあったようなじかんじゃねーの印象は消えてます！というわけで寝よー。てか9時か悩んでるなう・・・・ぼくだかも体調管理実装あ、情報処理技術者試験までは考えた</p>&mdash;
    ヨーグルト (@yootakuti) <a href="https://twitter.com/yootakuti/statuses/413693204735606784">December
    19, 2013</a></blockquote><script async src="//platform.twitter.com/widgets.js"
    charset="utf-8"></script>
author:
  login: takuti
  email: k.takuti@gmail.com
  display_name: "たくち"
  first_name: ''
  last_name: ''
---
<p><a href="http://blog.takuti.me/twitter-bot/">マルコフ連鎖でbotを作った</a>けどちょっとお粗末な発言が多い。</p>
<p>https://twitter.com/yootakuti/status/413693204735606784</p>
<p>やる気が感じられない。つなげりゃいいってもんじゃあない。</p>
<p>というわけで、生成するツイートの文字数に上限を設けてしまえば少なくとも上のようなぶっ飛んだ発言はなくなるだろうという考えの下に対策を施します。</p>
<p>もちろん対策前の上限はツイートの最高文字数である140文字です。これを何文字に制限しようか。<br />
<!--more--><br />
とりあえず僕自身 @<a href="https://twitter.com/takuti/">takuti</a> のツイートの文字数がどんな感じになっているのか調べます。対象は過去47,812ツイート。</p>
<p>各ツイートには以下の様な前処理をかけています。</p>
<pre class="prettyprint ruby">
# リプライをすべて削除
tweet = tweet.gsub(/\.?\s*@[0-9A-Za-z_]+/, '')
# RT/QT以降行末まで削除
tweet = tweet.gsub(/(RT|QT)\s*@?[0-9A-Za-z_]+.*$/, '')
# URLを削除 スペースが入るまで消える
tweet = tweet.gsub(/http:\/\/\S+/, '')
# ハッシュタグを削除
tweet = tweet.gsub(/#[0-9A-Za-z_]+/, '')
</pre>
<p>ツイートデータをダウンロードして前処理を行った後の文字数をそれぞれ数えてgnuplotでヒストグラムにすると以下のような結果に。</p>
<p><img src="http://blog.takuti.me/images/wp/source-e1387890887456.png" alt="source" width="500" height="375" class="alignnone size-full wp-image-395" /></p>
<p>この結果から、僕のツイートは80%が30文字以内、90%が40文字以内であることが分かります。</p>
<p>一方、マルコフ連鎖で生成したツイートの文字数はどうでしょうか。</p>
<p>@<a href="https://twitter.com/takuti/">takuti</a> のツイート数に合わせて、47,812個のサンプルツイートをマルコフ連鎖で生成します。デーモンを作って1日回しておけばOKです。そこから文字数のヒストグラムを作ると、</p>
<p><img src="http://blog.takuti.me/images/wp/markov-e1387896201933.png" alt="markov" width="500" height="375" class="alignnone size-full wp-image-396" /></p>
<p>ここまで綺麗な形になるとは思っていませんでしたが、やはり40文字以上の長いツイートが@<a href="https://twitter.com/takuti/">takuti</a>より多いことが分かり、文字数の少ないツイートをもっと増やしたい感じですね。</p>
<p>とまぁこんな結果が見れて満足したところで、今はマルコフ連鎖によるツイート生成の文字数上限を40文字に設定した上でbotを稼働させています。単純に、@<a href="https://twitter.com/takuti/">takuti</a> のツイートの90%が40文字以内ですからね。</p>
<p>短い発言なら支離滅裂でも結構なんとかなっちゃうものです。</p>
<p>https://twitter.com/yootakuti/status/415369180116811777</p>
<p>以上！<del datetime="2013-12-25T04:18:49+00:00">ヒストグラムにした意味は果たしてあったのか。</del></p>
<p>『<strong>いかに知的な発言をさせるか</strong>』よりも前に、まずは『<strong>いかに知的っぽく見せることができるか</strong>』という点を少しでもシンプルな方法で模索したいですね。</p>
